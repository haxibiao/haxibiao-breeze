{"version":3,"sources":["webpack:///./src/views/ChatPage.vue","webpack:///./src/components/MessageItem.vue","webpack:///./src/components/MessageItem.vue?7fe1","webpack:///./src/components/MessageItem.vue?8af7","webpack:///./src/views/parts/ChatsList.vue","webpack:///./src/views/parts/ChatsList.vue?d555","webpack:///./src/views/parts/ChatsList.vue?b86f","webpack:///./src/views/parts/MessagesView.vue","webpack:///./src/views/parts/MessagesView.vue?2225","webpack:///./src/views/parts/MessagesView.vue?663e","webpack:///./src/views/ChatPage.vue?f1e5","webpack:///./src/views/ChatPage.vue?b234","webpack:///./src/components/MessageItem.vue?6c33","webpack:///./src/views/ChatPage.vue?1877","webpack:///./src/components/LoadingSpinner.vue?5722","webpack:///./src/views/parts/ChatsList.vue?1f33","webpack:///./node_modules/core-js/modules/es.array.find-index.js","webpack:///./src/views/parts/MessagesView.vue?1ac7","webpack:///./src/components/LoadingSpinner.vue","webpack:///./src/components/LoadingSpinner.vue?21a6"],"names":["class","$router","go","show-message-view","showMessageView","with-chat-id","chat","id","chatName","ref","chat-id","message-status","messageStatus","content","clearable","maxlength","type","length","disabled","sendMessage","date","isSelf","message","user","src","avatar","alt","loading","error","body","url","props","Object","index","Number","messagesData","Array","default","setup","store","me","state","userId","value","moment","messageDateStr","created_at","render","__scopeId","infinite-scroll-disabled","chatsData","key","withChatId","removeChat","withUser","subject","name","lastMessage","loadMore","loadingMore","Function","components","Skeleton","LoadingSpinner","user_id","enabled","chats","hasMorePages","data","methods","this","findIndex","splice","chatId","loadLastPageMessages","messages-data","MessageItem","chat_id","messages","refetch","currentPage","scrollHeight","scrollToPosition","position","ele","document","getElementById","setTimeout","clientHeight","scrollTop","sendMessageSuccess","msgObj","prototype","toString","call","concat","console","log","messageObj","__typename","text","messageable","messageable_id","messageable_type","time_ago","ChatsList","MessagesView","currentChat","imageUrl","messageType","variables","sendMessageMutate","mutate","messagesViewRef","payloadMessage","isTextMessage","payload","msg","Date","onSendSuccess","err","res","computed","$","$findIndex","addToUnscopables","FIND_INDEX","SKIPS_HOLES","target","proto","forced","callbackfn","arguments","undefined"],"mappings":"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","file":"js/chunk-b2584b4a.626a2ea0.js","sourcesContent":["<template>\n  <Masthead />\n  <div class=\"chat-page\">\n    <div class=\"fluid-content\">\n      <div class=\"container\">\n        <div class=\"left\">\n          <div class=\"list-header text-ellipsis\">\n            <i class=\"el-icon-arrow-left back-icon\" @click=\"$router.go(-1)\"></i>\n            <span>聊天列表</span>\n          </div>\n          <ChatsList :show-message-view=\"showMessageView\" :with-chat-id=\"chat?.id\" />\n        </div>\n\n        <div class=\"right\">\n          <div class=\"message-header\">{{ chatName }}</div>\n          <MessagesView ref=\"messagesViewRef\" :chat-id=\"chat?.id\" :message-status=\"messageStatus\" />\n\n          <div class=\"send-box\">\n            <div class=\"operation-row\">\n              <label class=\"image-upload-btn\"></label>\n              <label class=\"emotion-btn-box\"></label>\n            </div>\n            <div class=\"send-input\">\n              <el-input v-model=\"content\" clearable maxlength=\"300\" type=\"textarea\" />\n            </div>\n            <div class=\"flex-end-send-btn\">\n              <div class=\"indicator\">{{ content?.length || 0 }}/300</div>\n              <button :class=\"['send-button', content && 'active']\" :disabled=\"!content\" @click=\"sendMessage\">\n                <span class=\"btn-title\">发送</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { useMutation } from '@vue/apollo-composable';\nimport { exceptionCapture, errorMessage } from '@/common';\nimport { SEND_MESSAGE_MUTATION } from '@/graphql';\nimport MessageItem from '@/components/MessageItem.vue';\nimport ChatsList from './parts/ChatsList.vue';\nimport MessagesView from './parts/MessagesView.vue';\n\nconst messageObj = {\n  __typename: 'Message',\n  body: {\n    __typename: 'MessageBody',\n    text: '',\n    url: null\n  },\n  created_at: '',\n  id: 1,\n  message: '',\n  messageable: null,\n  messageable_id: null,\n  messageable_type: null,\n  time_ago: '1秒前',\n  type: 'text',\n  user: {}\n};\n\nexport default {\n  components: { MessageItem, ChatsList, MessagesView },\n  setup() {\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n\n    // const chat = ref();\n    const chat = ref({ id: 46, user_id: null, subject: '', withUser: { name: '' } });\n\n    function showMessageView(currentChat) {\n      if (currentChat?.id) {\n        chat.value = currentChat;\n        console.log('chat.value.id', chat.value?.id);\n      }\n    }\n\n    const content = ref(''); // 消息内容\n    const imageUrl = ref(''); // 图片url\n    const messageType = ref('text'); // 消息类型(目前仅实现text, image)\n    const messageStatus = ref({ loading: false, error: '' });\n\n    const { mutate: sendMessageMutate } = useMutation(SEND_MESSAGE_MUTATION, () => ({\n      variables: {\n        user_id: me.value?.id,\n        chat_id: chat.value?.id,\n        message: messageType.value === 'text' ? content.value : '',\n        url: messageType.value === 'text' ? '' : imageUrl.value\n      }\n    }));\n\n    const messagesViewRef = ref(null);\n    function payloadMessage(isTextMessage) {\n      const payload = isTextMessage\n        ? { type: 'text', message: content.value, body: { ...messageObj?.body, text: content.value } }\n        : { type: 'image', message: '', body: { ...messageObj?.body, url: imageUrl.value } };\n\n      const msg = {\n        ...messageObj,\n        ...payload,\n        user: { ...me.value },\n        created_at: new Date()\n      };\n\n      // sendMessageSuccess：消息列表组件中的函数。用于追加msg对象到消息列表，滚动到消息列表底部\n      const onSendSuccess = messagesViewRef.value?.sendMessageSuccess;\n      if (Object.prototype.toString.call(onSendSuccess) === '[object Function]') {\n        onSendSuccess(msg);\n      }\n    }\n\n    async function sendMessage() {\n      let isTextMessage = messageType.value === 'text';\n      if ((isTextMessage && !content.value) || (!isTextMessage && !imageUrl.value)) {\n        ElMessage.error('消息内容不能为空或者您还未选中图片！');\n        return;\n      }\n\n      // 预先渲染消息\n      payloadMessage(isTextMessage);\n\n      // 发送消息\n      messageStatus.value.loading = true;\n      const [err, res] = await exceptionCapture(() => sendMessageMutate());\n      if (err) {\n        messageStatus.value = { loading: false, error: err };\n        ElMessage.error(`Error：${errorMessage(err)}`);\n      } else if (res?.data?.sendMessage) {\n        messageStatus.value = { loading: false, error: '' };\n        content.value = '';\n      }\n    }\n\n    return {\n      content,\n      chat,\n      sendMessage,\n      messageStatus,\n      showMessageView,\n      messagesViewRef\n    };\n  },\n  computed: {\n    chatName() {\n      return this.chat?.subject || this.chat?.withUser?.name || '聊天消息';\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n$bg-color: #fff2f6;\n$border-color: #e9eaec;\n\n.chat-page {\n  width: 100%;\n  padding: 30px 0;\n  font-size: 15px;\n  line-height: 22px;\n  box-sizing: border-box;\n  background-color: $bg-color;\n}\n.container {\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  max-width: 1200px;\n  height: calc(100vh - 60px - var(--header-height));\n  margin: 0 auto;\n  border: 1px solid $border-color;\n  border-radius: 6px;\n  box-shadow: 0 2px 4px 0 rgb(254 220 231 / 54%);\n  background-color: #fff;\n}\n.left {\n  width: 24%;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid $border-color;\n  .list-header {\n    font-size: 14px;\n    color: #333;\n    height: 42px;\n    padding: 0 15px;\n    display: flex;\n    align-items: center;\n    border-bottom: 1px solid $border-color;\n    .back-icon {\n      font-size: 18px;\n      margin-right: 10px;\n    }\n  }\n}\n.right {\n  width: 76%;\n  display: flex;\n  flex-direction: column;\n  .message-header {\n    height: 42px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #333;\n    border-bottom: 1px solid $border-color;\n  }\n  .send-box {\n    height: 182px;\n    border-top: 1px solid #d8d8d8;\n    border-bottom-right-radius: 6px;\n    background-color: #f4f5f7;\n    flex-shrink: 0;\n    padding: 0 16px 5px;\n    position: relative;\n    z-index: 2;\n    .send-input {\n      border-radius: 8px;\n      overflow: hidden;\n      height: calc(100% - 48px - 46px);\n      :deep(.el-textarea) {\n        height: 100%;\n        .el-textarea__inner {\n          height: 100%;\n          border: none;\n          color: #222;\n          font-size: 14px;\n          letter-spacing: 1px;\n          white-space: pre-wrap;\n          padding: 5px 8px 5px 3px;\n          background-color: transparent;\n          word-break: break-word;\n          word-wrap: break-word;\n        }\n      }\n    }\n  }\n  .send-box .operation-row {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    height: 48px;\n    .image-upload-btn {\n      display: block;\n      width: 22px;\n      height: 21px;\n      cursor: pointer;\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAYAAABCIB6VAAAAAXNSR0IArs4c6QAAAjFJREFUOBG1lUtrU0EUgHMfSX5AkEINSOmii4JuigihFERpoIgrsykEal6bLgQ34h8oXZUiCnlgaRZSshErhZQWAn24sEUFoSRIQQlEEZJNaRpoHn7n0gupN2mTWx04mTkz53znzJm5E8Vx1pLJ5P1mszmpKMqgOddP32q1SqqqrkcikQ3xU+UnHo8vAs0CHRPdThNfYQhL/JVEInGPaOuapk2Fw+GsHajpk0ql/I1GY43M/SpQP9G2rwoVuDCEJSVVGUhNS2ZU6YnsQx4Q1ChV+1oP45IwLY6UJsB2dpBVDnSuB1BHEwuYLNsPsH3cEdBt0gLGMI4cIL8Q2xnrOJ9rsVjskInRc5M2lE4Z28BYXf4b2FIKa2zrDLdlgFszyUHfZPUU+ezxeN4HAoET07ovcC6X0wuFwvN6vf4MwE/kI3dWo58pl8uvuKqP+wYLNJ/Pr+B4m0/2EYe8ZkIymYxWqVRm2UWGta8E+yZvxRsx8Hq9M8Vi8Snbm0YdQRrIF2TZ7Xa/rtVq84wfOp3OCT7dH4wtjQdoCv93LGwZYBQducHENfp5HqRPRHeh+5BZMpDaDZGNLxqN7jHu2oB/YPHUqDGPxh2U3y6X61YoFDpq89pNp9Mvq9XqAvCly6Dih9136XWg0l9ni3f/gsq8IxgMHtNFDaW3n0F2va/quv6WLToIMNybX3creY+BjpN1VhGzs1dfarmNWurueuGKZCrQF5TsiQEW83/xnyeZAt0U3h+pCu2ZMB0nRQAAAABJRU5ErkJggg==)\n        no-repeat;\n      background-size: 22px;\n      margin-right: 16px;\n    }\n    .emotion-btn-box {\n      display: block;\n      width: 24px;\n      height: 24px;\n      cursor: pointer;\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAB5UlEQVR4AWIYMDBz5kzH2bNnOxGhzmbOnDnWJFswa9asSYDWygCigSgO41YAJQAoWSMgAIQASQoUQJbEZAGM0aRERQAEuAFgAkIpAVXDUAzAKLBEQWptcf0+Hp6zd3fPGp+z//u+7/9/9+67Q/wWBMGoi1Or1UbgvMI99W5QrVYnEHfYxV7M9LvisIPJ1MaaCtMVpiojvpcBOAb7EajWgfcgrjTSxppD2kT0jqANrsEleKZ2wfXchmrgRRzDbUsrD9c9L4FPCBthGA753lJppJWHvKLm03Tvcl0c9OmTB149edqHdULh6r8ecXnJ0y7cgLJ9FvwvehgW7XsvL3nahAaEgtVgntoHOGOSMZex1sQRVxpLX5Cns4HJwZTqoAUWouaqmbWGuKp5NdCPFK8y5Rfr9T4N6loTR/+9Guj1QC0wQSr1e2xV05rhBNKkbsD/I4SPYCbpgMWB/8T1MHUDIj/MhBmPkGWk8T4DQ55TCEFoA82P4zXt1wCzHOu/Mo2ghyabtoGSV4kJ0pYMLfOuguXiy0ueduGAwm3CYeYw3TapzSYk+06e9pbGKX5zXRv0PSQP5UOe0QnXdXAs7CR+ONyfz4rxyLu2tgxaJjxN0EiJpjRGu5T44SCVs5oCFFIiL02/xP8BToUvO6m2Rg4AAAAASUVORK5CYII=)\n        no-repeat;\n    }\n  }\n  .send-box .flex-end-send-btn {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-end;\n    align-items: center;\n    height: 46px;\n    .indicator {\n      color: #c0c0c0;\n      font-size: 14px;\n      line-height: 30px;\n    }\n    .send-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 84px;\n      height: 30px;\n      border-radius: 4px;\n      margin-left: 15px;\n      border: 1px solid #e7e7e7;\n      cursor: pointer;\n      background-color: #ffffff;\n      .btn-title {\n        color: rgba(47, 48, 53, 0.9);\n        font-size: 14px;\n        font-weight: 500;\n        line-height: 22px;\n      }\n      &.active {\n        background-color: $theme-color_primary;\n        .btn-title {\n          color: #ffffff;\n        }\n      }\n    }\n  }\n}\n</style>\n","<template>\n  <div>\n    <div class=\"msg-center-tips msg-date\" v-if=\"date\">\n      {{ date }}\n    </div>\n    <div :class=\"['message-item', isSelf(message?.user?.id) && 'message-item-right']\">\n      <img v-if=\"!isSelf(message?.user?.id)\" :src=\"message?.user?.avatar\" alt=\"avatar\" class=\"message-avatar\" />\n      <div class=\"flex-row-align-center\">\n        <div v-if=\"isSelf(message?.user?.id)\" :class=\"['send-status', 'right']\">\n          <i v-if=\"messageStatus.loading\" class=\"el-icon-loading\" />\n          <i v-else-if=\"messageStatus.error\" class=\"el-icon-warning send-error-icon\" />\n        </div>\n        <div class=\"message-text\" v-if=\"message?.type === 'text'\">\n          {{ message?.message }}\n        </div>\n        <div class=\"message-image\" v-else-if=\"message?.type === 'image'\">\n          <img :src=\"message?.body?.url\" alt=\"图片\" class=\"message-img\" />\n        </div>\n        <div v-if=\"!isSelf(message?.user?.id)\" :class=\"['send-status', 'left']\">\n          <i v-if=\"messageStatus.loading\" class=\"el-icon-loading\" />\n          <i v-else-if=\"messageStatus.error\" class=\"el-icon-warning send-error-icon\" />\n        </div>\n      </div>\n      <img v-if=\"isSelf(message?.user?.id)\" :src=\"message?.user?.avatar\" alt=\"avatar\" class=\"message-avatar\" />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref, watch, toRefs } from 'vue';\nimport { useStore } from 'vuex';\nimport moment from '@/common/moment';\n\nexport default {\n  props: {\n    message: Object,\n    index: Number,\n    messageStatus: Object as () => {\n      loading: Boolean | String;\n      error: String;\n    },\n    messagesData: {\n      type: Array,\n      default: []\n    }\n  },\n  setup(props) {\n    const { message, index, messageStatus, messagesData } = toRefs(props);\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n    const isSelf = (userId: number) => (userId ? userId === me.value?.id : false);\n\n    const date = computed(() =>\n      moment.messageDateStr(message.value?.created_at, messagesData.value?.[index.value - 1]?.created_at || '')\n    );\n\n    return { message, index, messageStatus, messagesData, date, isSelf };\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.el-icon-loading {\n  color: #999;\n  font-size: 18px;\n  &.large-size {\n    font-size: 20px;\n  }\n}\n.msg-center-tips {\n  color: #999;\n  font-size: 14px;\n  line-height: 1.5;\n  padding: 16px 0 0;\n  text-align: center;\n  min-height: 38px;\n  &.msg-date {\n    padding: 20px 0;\n  }\n}\n.message-item {\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  min-height: 48px;\n  padding: 0 16px 16px;\n  overflow: hidden;\n  position: relative;\n  .flex-row-align-center {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n  }\n  .message-avatar {\n    width: 30px;\n    height: 30px;\n    border-radius: 50%;\n    background-color: #eeeeee;\n  }\n  .message-text {\n    font-size: 14px;\n    line-height: 1.5;\n    max-width: 60%;\n    min-height: 37px;\n    padding: 8px 16px;\n    margin: 0 10px;\n    word-wrap: break-word;\n    word-break: break-word;\n    border-radius: 0 16px 16px 16px;\n    overflow: hidden;\n    background: #fff;\n  }\n  .message-image {\n    max-width: 60%;\n    margin: 0 10px;\n    border-radius: 16px;\n    overflow: hidden;\n    background: #fff;\n    .message-img {\n      width: 100px;\n      height: 100px;\n      border-radius: 16px;\n    }\n  }\n  .send-status {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    &.left {\n      justify-content: flex-start;\n    }\n    &.right {\n      justify-content: flex-end;\n    }\n    .send-error-icon {\n      color: #dd001c;\n    }\n  }\n  &.message-item-right {\n    justify-content: flex-end;\n    .message-text,\n    .message-image {\n      border-radius: 16px 0 16px 16px;\n    }\n  }\n}\n</style>\n","\nimport { computed, ref, watch, toRefs } from 'vue';\nimport { useStore } from 'vuex';\nimport moment from '@/common/moment';\n\nexport default {\n  props: {\n    message: Object,\n    index: Number,\n    messageStatus: Object as () => {\n      loading: Boolean | String;\n      error: String;\n    },\n    messagesData: {\n      type: Array,\n      default: []\n    }\n  },\n  setup(props) {\n    const { message, index, messageStatus, messagesData } = toRefs(props);\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n    const isSelf = (userId: number) => (userId ? userId === me.value?.id : false);\n\n    const date = computed(() =>\n      moment.messageDateStr(message.value?.created_at, messagesData.value?.[index.value - 1]?.created_at || '')\n    );\n\n    return { message, index, messageStatus, messagesData, date, isSelf };\n  }\n};\n","import { render } from \"./MessageItem.vue?vue&type=template&id=25d7c6f8&scoped=true\"\nimport script from \"./MessageItem.vue?vue&type=script&lang=ts\"\nexport * from \"./MessageItem.vue?vue&type=script&lang=ts\"\n\nimport \"./MessageItem.vue?vue&type=style&index=0&id=25d7c6f8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-25d7c6f8\"\n\nexport default script","<template>\n  <div class=\"chats-wrap\">\n    <div v-if=\"loading\" class=\"loading-box\">\n      <Skeleton type=\"comments\" />\n    </div>\n    <ul\n      v-else-if=\"chatsData?.length\"\n      class=\"chats-list\"\n      v-infinite-scroll=\"loadMore\"\n      infinite-scroll-disabled=\"!hasMorePages\"\n    >\n      <li\n        v-for=\"chat in chatsData\"\n        :key=\"chat?.id\"\n        :class=\"['chat-item', withChatId === chat?.id && 'active']\"\n        @click=\"showMessageView(chat)\"\n      >\n        <div class=\"close-icon\" @click=\"removeChat(chat)\">\n          <i class=\"el-icon-close\"></i>\n        </div>\n        <div class=\"avatar-box\">\n          <img :src=\"chat?.withUser?.avatar\" alt=\"avatar\" class=\"user-avatar\" />\n        </div>\n        <div class=\"chat-info\">\n          <div class=\"user-name text-ellipsis\">\n            {{ chat?.subject || chat?.withUser?.name }}\n          </div>\n          <p class=\"last-message text-ellipsis\">{{ chat?.lastMessage?.message }}</p>\n        </div>\n      </li>\n    </ul>\n    <LoadingSpinner v-if=\"loadingMore\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { ref, watch, toRefs } from 'vue';\nimport { useStore } from 'vuex';\nimport { useChatsQuery } from '@/graphql';\nimport Skeleton from '@/components/Skeleton.vue';\nimport LoadingSpinner from '@/components/LoadingSpinner.vue';\n\nexport default {\n  props: {\n    showMessageView: Function,\n    withChatId: Number\n  },\n  components: {\n    Skeleton,\n    LoadingSpinner\n  },\n  setup(props) {\n    const { showMessageView, withChatId } = toRefs(props);\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n\n    const chatsData = ref();\n    const { chats, loading, hasMorePages, loadMore, loadingMore } = useChatsQuery(\n      { user_id: me.value?.id },\n      { enabled: !!me.value?.id }\n    );\n\n    watch(chats, data => {\n      chatsData.value = [...data];\n      showMessageView.value(data?.[0] || []);\n    });\n\n    return {\n      withChatId,\n      chatsData,\n      loading,\n      hasMorePages,\n      loadMore,\n      loadingMore,\n      showMessageView\n    };\n  },\n  methods: {\n    removeChat(data) {\n      const index = this.chatsData.findIndex(chat => chat.id === data.id);\n      this.chatsData?.splice(index, 1);\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.chats-wrap {\n  flex: 1;\n  position: relative;\n  overflow-x: hidden;\n  overflow-y: auto;\n  background-color: #fff;\n}\n::-webkit-scrollbar-track {\n  background-color: #f4f5f7;\n}\n.loading-box {\n  padding: 0 20px;\n}\n.chats-list {\n  .chat-item {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    padding: 20px;\n    background-color: #ffffff;\n    &.active {\n      background-color: #e4e5e6;\n    }\n    .close-icon {\n      position: absolute;\n      left: -16px;\n      top: 20px;\n      display: block;\n      height: 48px;\n      transition: transform ease-out 0.25s;\n      opacity: 0;\n      .el-icon-close {\n        color: #999;\n        font-size: 18px;\n        font-weight: 500;\n        line-height: 48px;\n      }\n    }\n    .avatar-box {\n      margin-right: 10px;\n      .user-avatar {\n        width: 48px;\n        height: 48px;\n        border-radius: 24px;\n      }\n    }\n    .chat-info {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-around;\n      .user-name {\n        flex: 1;\n        font-size: 15px;\n        line-height: 22px;\n      }\n      .last-message {\n        display: flex;\n        color: #999;\n        font-size: 13px;\n        font-weight: 500;\n        line-height: 20px;\n      }\n    }\n    &:hover {\n      .close-icon {\n        opacity: 1;\n        transform: translateX(16px);\n      }\n    }\n  }\n}\n</style>\n","\nimport { ref, watch, toRefs } from 'vue';\nimport { useStore } from 'vuex';\nimport { useChatsQuery } from '@/graphql';\nimport Skeleton from '@/components/Skeleton.vue';\nimport LoadingSpinner from '@/components/LoadingSpinner.vue';\n\nexport default {\n  props: {\n    showMessageView: Function,\n    withChatId: Number\n  },\n  components: {\n    Skeleton,\n    LoadingSpinner\n  },\n  setup(props) {\n    const { showMessageView, withChatId } = toRefs(props);\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n\n    const chatsData = ref();\n    const { chats, loading, hasMorePages, loadMore, loadingMore } = useChatsQuery(\n      { user_id: me.value?.id },\n      { enabled: !!me.value?.id }\n    );\n\n    watch(chats, data => {\n      chatsData.value = [...data];\n      showMessageView.value(data?.[0] || []);\n    });\n\n    return {\n      withChatId,\n      chatsData,\n      loading,\n      hasMorePages,\n      loadMore,\n      loadingMore,\n      showMessageView\n    };\n  },\n  methods: {\n    removeChat(data) {\n      const index = this.chatsData.findIndex(chat => chat.id === data.id);\n      this.chatsData?.splice(index, 1);\n    }\n  }\n};\n","import { render } from \"./ChatsList.vue?vue&type=template&id=03d3dd01&scoped=true\"\nimport script from \"./ChatsList.vue?vue&type=script&lang=ts\"\nexport * from \"./ChatsList.vue?vue&type=script&lang=ts\"\n\nimport \"./ChatsList.vue?vue&type=style&index=0&id=03d3dd01&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-03d3dd01\"\n\nexport default script","<template>\n  <div id=\"message-list\" class=\"message-list\">\n    <template v-if=\"chatId\">\n      <div class=\"msg-center-tips\" @click=\"loadLastPageMessages\">\n        <i v-if=\"loading || loadingMore\" class=\"el-icon-loading\" />\n        <div v-else>{{ hasMorePages ? '加载更多消息' : '没有更多消息了~' }}</div>\n      </div>\n      <div v-if=\"messagesData?.length\">\n        <div v-for=\"(message, index) in messagesData\" :key=\"message?.id\">\n          <MessageItem\n            :message=\"message\"\n            :index=\"index\"\n            :message-status=\"messageStatus\"\n            :messages-data=\"messagesData\"\n          />\n        </div>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { toRefs, ref, watch } from 'vue';\nimport { useChatMessagesQuery } from '@/graphql';\nimport MessageItem from '@/components/MessageItem.vue';\n\nexport default {\n  props: {\n    chatId: Number,\n    messageStatus: Object as () => { loading: boolean; error: string }\n  },\n  components: {\n    MessageItem\n  },\n  setup(props) {\n    const { chatId, messageStatus } = toRefs(props);\n\n    const {\n      messages,\n      refetch,\n      loading,\n      currentPage,\n      hasMorePages,\n      disabled,\n      loadMore,\n      loadingMore\n    } = useChatMessagesQuery({ chat_id: chatId }, { enabled: !!chatId.value });\n    const messagesData = ref(messages.value);\n\n    function loadLastPageMessages() {\n      if (!disabled.value) {\n        loadMore();\n      }\n    }\n\n    const scrollHeight = ref(0);\n    function scrollToPosition(position?: 'bottom' | 'normal') {\n      let ele = document.getElementById('message-list');\n      setTimeout(function() {\n        if (position === 'bottom') {\n          // 设置滚动条到最底部\n          if (ele.scrollHeight > ele.clientHeight) {\n            ele.scrollTop = ele.scrollHeight;\n          }\n        } else {\n          // 滚动到当前浏览位置\n          if (ele.scrollHeight > ele.clientHeight && scrollHeight.value > 0) {\n            ele.scrollTop = Number(ele.scrollHeight - scrollHeight.value);\n          }\n        }\n        scrollHeight.value = ele.scrollHeight;\n      }, 0);\n    }\n\n    function sendMessageSuccess(msgObj) {\n      if (Object.prototype.toString.call(msgObj) === '[object Object]') {\n        messagesData.value = messagesData.value.concat(msgObj);\n      }\n      scrollToPosition('bottom');\n    }\n\n    watch(chatId, id => {\n      refetch();\n    });\n\n    watch(messages, () => {\n      messagesData.value = messages.value;\n      if (currentPage.value == 1) {\n        scrollToPosition('bottom');\n      } else {\n        scrollToPosition();\n      }\n      console.log('messagesData', messagesData.value);\n    });\n\n    return {\n      chatId,\n      messagesData,\n      loading,\n      loadingMore,\n      hasMorePages,\n      loadLastPageMessages,\n      messageStatus,\n      sendMessageSuccess // 给兄弟组件调用\n    };\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n::-webkit-scrollbar-track {\n  background-color: transparent;\n}\n.message-list {\n  flex: 1;\n  position: relative;\n  overflow-x: hidden;\n  overflow-y: scroll;\n  background-color: #f4f5f7;\n  .msg-center-tips {\n    color: #999;\n    font-size: 14px;\n    line-height: 1.5;\n    padding: 16px 0 0;\n    text-align: center;\n    min-height: 38px;\n    .el-icon-loading {\n      color: #999;\n      font-size: 20px;\n    }\n  }\n}\n</style>\n","\nimport { toRefs, ref, watch } from 'vue';\nimport { useChatMessagesQuery } from '@/graphql';\nimport MessageItem from '@/components/MessageItem.vue';\n\nexport default {\n  props: {\n    chatId: Number,\n    messageStatus: Object as () => { loading: boolean; error: string }\n  },\n  components: {\n    MessageItem\n  },\n  setup(props) {\n    const { chatId, messageStatus } = toRefs(props);\n\n    const {\n      messages,\n      refetch,\n      loading,\n      currentPage,\n      hasMorePages,\n      disabled,\n      loadMore,\n      loadingMore\n    } = useChatMessagesQuery({ chat_id: chatId }, { enabled: !!chatId.value });\n    const messagesData = ref(messages.value);\n\n    function loadLastPageMessages() {\n      if (!disabled.value) {\n        loadMore();\n      }\n    }\n\n    const scrollHeight = ref(0);\n    function scrollToPosition(position?: 'bottom' | 'normal') {\n      let ele = document.getElementById('message-list');\n      setTimeout(function() {\n        if (position === 'bottom') {\n          // 设置滚动条到最底部\n          if (ele.scrollHeight > ele.clientHeight) {\n            ele.scrollTop = ele.scrollHeight;\n          }\n        } else {\n          // 滚动到当前浏览位置\n          if (ele.scrollHeight > ele.clientHeight && scrollHeight.value > 0) {\n            ele.scrollTop = Number(ele.scrollHeight - scrollHeight.value);\n          }\n        }\n        scrollHeight.value = ele.scrollHeight;\n      }, 0);\n    }\n\n    function sendMessageSuccess(msgObj) {\n      if (Object.prototype.toString.call(msgObj) === '[object Object]') {\n        messagesData.value = messagesData.value.concat(msgObj);\n      }\n      scrollToPosition('bottom');\n    }\n\n    watch(chatId, id => {\n      refetch();\n    });\n\n    watch(messages, () => {\n      messagesData.value = messages.value;\n      if (currentPage.value == 1) {\n        scrollToPosition('bottom');\n      } else {\n        scrollToPosition();\n      }\n      console.log('messagesData', messagesData.value);\n    });\n\n    return {\n      chatId,\n      messagesData,\n      loading,\n      loadingMore,\n      hasMorePages,\n      loadLastPageMessages,\n      messageStatus,\n      sendMessageSuccess // 给兄弟组件调用\n    };\n  }\n};\n","import { render } from \"./MessagesView.vue?vue&type=template&id=67536c1b&scoped=true\"\nimport script from \"./MessagesView.vue?vue&type=script&lang=ts\"\nexport * from \"./MessagesView.vue?vue&type=script&lang=ts\"\n\nimport \"./MessagesView.vue?vue&type=style&index=0&id=67536c1b&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-67536c1b\"\n\nexport default script","\nimport { ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { useMutation } from '@vue/apollo-composable';\nimport { exceptionCapture, errorMessage } from '@/common';\nimport { SEND_MESSAGE_MUTATION } from '@/graphql';\nimport MessageItem from '@/components/MessageItem.vue';\nimport ChatsList from './parts/ChatsList.vue';\nimport MessagesView from './parts/MessagesView.vue';\n\nconst messageObj = {\n  __typename: 'Message',\n  body: {\n    __typename: 'MessageBody',\n    text: '',\n    url: null\n  },\n  created_at: '',\n  id: 1,\n  message: '',\n  messageable: null,\n  messageable_id: null,\n  messageable_type: null,\n  time_ago: '1秒前',\n  type: 'text',\n  user: {}\n};\n\nexport default {\n  components: { MessageItem, ChatsList, MessagesView },\n  setup() {\n    const store = useStore();\n    const me = ref(store.state?.user?.user);\n\n    // const chat = ref();\n    const chat = ref({ id: 46, user_id: null, subject: '', withUser: { name: '' } });\n\n    function showMessageView(currentChat) {\n      if (currentChat?.id) {\n        chat.value = currentChat;\n        console.log('chat.value.id', chat.value?.id);\n      }\n    }\n\n    const content = ref(''); // 消息内容\n    const imageUrl = ref(''); // 图片url\n    const messageType = ref('text'); // 消息类型(目前仅实现text, image)\n    const messageStatus = ref({ loading: false, error: '' });\n\n    const { mutate: sendMessageMutate } = useMutation(SEND_MESSAGE_MUTATION, () => ({\n      variables: {\n        user_id: me.value?.id,\n        chat_id: chat.value?.id,\n        message: messageType.value === 'text' ? content.value : '',\n        url: messageType.value === 'text' ? '' : imageUrl.value\n      }\n    }));\n\n    const messagesViewRef = ref(null);\n    function payloadMessage(isTextMessage) {\n      const payload = isTextMessage\n        ? { type: 'text', message: content.value, body: { ...messageObj?.body, text: content.value } }\n        : { type: 'image', message: '', body: { ...messageObj?.body, url: imageUrl.value } };\n\n      const msg = {\n        ...messageObj,\n        ...payload,\n        user: { ...me.value },\n        created_at: new Date()\n      };\n\n      // sendMessageSuccess：消息列表组件中的函数。用于追加msg对象到消息列表，滚动到消息列表底部\n      const onSendSuccess = messagesViewRef.value?.sendMessageSuccess;\n      if (Object.prototype.toString.call(onSendSuccess) === '[object Function]') {\n        onSendSuccess(msg);\n      }\n    }\n\n    async function sendMessage() {\n      let isTextMessage = messageType.value === 'text';\n      if ((isTextMessage && !content.value) || (!isTextMessage && !imageUrl.value)) {\n        ElMessage.error('消息内容不能为空或者您还未选中图片！');\n        return;\n      }\n\n      // 预先渲染消息\n      payloadMessage(isTextMessage);\n\n      // 发送消息\n      messageStatus.value.loading = true;\n      const [err, res] = await exceptionCapture(() => sendMessageMutate());\n      if (err) {\n        messageStatus.value = { loading: false, error: err };\n        ElMessage.error(`Error：${errorMessage(err)}`);\n      } else if (res?.data?.sendMessage) {\n        messageStatus.value = { loading: false, error: '' };\n        content.value = '';\n      }\n    }\n\n    return {\n      content,\n      chat,\n      sendMessage,\n      messageStatus,\n      showMessageView,\n      messagesViewRef\n    };\n  },\n  computed: {\n    chatName() {\n      return this.chat?.subject || this.chat?.withUser?.name || '聊天消息';\n    }\n  }\n};\n","import { render } from \"./ChatPage.vue?vue&type=template&id=4b7e30d4&scoped=true\"\nimport script from \"./ChatPage.vue?vue&type=script&lang=ts\"\nexport * from \"./ChatPage.vue?vue&type=script&lang=ts\"\n\nimport \"./ChatPage.vue?vue&type=style&index=0&id=4b7e30d4&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-4b7e30d4\"\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/dist/index.js??ref--0-1!./MessageItem.vue?vue&type=style&index=0&id=25d7c6f8&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/dist/index.js??ref--0-1!./ChatPage.vue?vue&type=style&index=0&id=4b7e30d4&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/dist/index.js??ref--0-1!./LoadingSpinner.vue?vue&type=style&index=0&id=5999f142&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/dist/index.js??ref--0-1!./ChatsList.vue?vue&type=style&index=0&id=03d3dd01&lang=scss&scoped=true\"","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.es/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/dist/index.js??ref--0-1!./MessagesView.vue?vue&type=style&index=0&id=67536c1b&lang=scss&scoped=true\"","<template>\n  <div class=\"ld-container\">\n    <div class=\"ld-ellipsis\">\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  setup() {\n    return {};\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.ld-container {\n  display: flex;\n  justify-content: center;\n}\n.ld-ellipsis {\n  display: inline-block;\n  position: relative;\n  width: 76px;\n  height: 52px;\n}\n.ld-ellipsis div {\n  position: absolute;\n  top: 20px;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background: $theme-color_primary;\n  animation-timing-function: cubic-bezier(0, 1, 1, 0);\n}\n.ld-ellipsis div:nth-child(1) {\n  left: 8px;\n  animation: ld-ellipsis1 0.6s infinite;\n}\n.ld-ellipsis div:nth-child(2) {\n  left: 8px;\n  animation: ld-ellipsis2 0.6s infinite;\n}\n.ld-ellipsis div:nth-child(3) {\n  left: 32px;\n  animation: ld-ellipsis2 0.6s infinite;\n}\n.ld-ellipsis div:nth-child(4) {\n  left: 56px;\n  animation: ld-ellipsis3 0.6s infinite;\n}\n@keyframes ld-ellipsis1 {\n  0% {\n    transform: scale(0);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n@keyframes ld-ellipsis3 {\n  0% {\n    transform: scale(1);\n  }\n  100% {\n    transform: scale(0);\n  }\n}\n@keyframes ld-ellipsis2 {\n  0% {\n    transform: translate(0, 0);\n  }\n  100% {\n    transform: translate(24px, 0);\n  }\n}\n</style>\n","import { render } from \"./LoadingSpinner.vue?vue&type=template&id=5999f142&scoped=true\"\nimport script from \"./LoadingSpinner.vue?vue&type=script&lang=js\"\nexport * from \"./LoadingSpinner.vue?vue&type=script&lang=js\"\n\nimport \"./LoadingSpinner.vue?vue&type=style&index=0&id=5999f142&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5999f142\"\n\nexport default script"],"sourceRoot":""}